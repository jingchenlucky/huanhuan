# dva

> 官方网站：https://dvajs.com/    yarn add dva
> dva 不仅仅是一个第三方库，更是一个框架，它主要融合了 redux 的相关内容，让我们处理数据更加容易，实际上，dva 依赖了很多：react,react-router,redux,redux-saga,react-redux,connected-react-router
![](assets/2019-09-06-18-39-36.png)
# dva的使用
1. dva默认导出一个函数，调用该函数，得到一个dva对象
2. dva对象.router:路由方法，传入一个函数，该函数返回一个React节点，将来应用程序启动后，会自动渲染该节点。
3. dva对象.start:该方法用于启动dva应用程序，可以认为启动的就是react程序，该函数传入一个选择器，用于选中页面中某个dom元素，react会内容渲染到该元素内部。
4. dva对象.model:该方法用于定义一个模型，该模型可以理解为redux的action,reducer，redux-saga副作用处理的整合，整合成一个对象，将该对象传入modal方法即可
    1. namespace:命名空间，该属性是一个字符串，字符串的值会被作为仓库中的属性保存。
    2. state:该模型的默认状态
    3. reducers:该属性配置为一个对象，对象中的每一个方法就是一个reducer,dva约定方法的名字就是匹配的action类型
    4. effects:处理副作用，底层是redux-saga实现的，该属性配置为一个对象，对象中的每个方法均处理一个副作用，方法的名字就是匹配的action类型。仅处理副作用，不改变状态，需要重新触发reducer来改变状态
    5. subscriptions:配置为一个对象，该对象中可以写任意数量任意名称的属性，每个属性是一个函数，这些函数会在模型加入到仓库后立即运行。会在刚开始的时候运行一次。
5. 在dva中同步路由到仓库 
    1. 在调用dva函数时，配置history对象
    2. 使用ConnectedRouter提供路由上下文
   (原先redux和react的结合，用到connected-react-router库，步骤：（1）connectRouter函数，传入history对象，得到一个reducer（2）routerMiddleware函数传入，history对象，得到一个中间件（3）ConnectedRouter传入history对象，提供路由上下文。现在（1）（2）两部dva已经做了，但没有传入history，默认传入了createHashHistory
6. 配置：
    1. history:同步到仓库的history对象
    2. initialState：创建redux仓库时使用的默认状态
    3. onError:当仓库的运行发生错误的时候，运行的函数
    4. onAction:触发action的时候调用，可以配置redux中间件
        1. 传入一个中间件对象
        2. 传入一个中间件数组
    5. onStateChange:当仓库状态发生变化时候运行的函数
    6. onReducer对模型中的reducer进一步封装
    7. onEffect:对模型中对effect进一步封装
    8. extraReducers：用于配置额外的reducer，它是一个对象，对象的每一个属性是一个方法，每个方法就是一个需要合并的reducer,方法名即属性名
    9. extraEnhancers：它是用于封装createstore函数的，dva会将原来的仓库创建函数作为参数传递，返回一个新的用于创建仓库的函数。函数必须放入一个数组中